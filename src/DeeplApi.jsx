//----------------------------------------
// ▼Reactと必要なhooksをインポート
//----------------------------------------
import React, { useState, useEffect } from "react";

//--------------------------------------------
// ▼HTTPリクエストを行うaxiosライブラリをインポート
// axiosを使うことで外部のAPiを使用することができる
//--------------------------------------------
import axios from "axios";

//------------------------------------------------------------------------------------------------------------
// ▼ステート（ステートはアプリ内で変更される可能性があるデータを保持する変数のようなもの）
//------------------------------------------------------------------------------------------------------------
const DeeplApi = () => {
  const [inputText, setInputText] = useState(""); // ▼テキストエリアの入力内容を保存するためのステート

  const [translatedText, setTranslatedText] = useState(""); // 翻訳結果を保存するためのステート

  const [language, setLanguage] = useState("EN-US"); //選択された言語を保存するためのステート

  //------------------------------------------------------------------------------------------------------------
  // ▼関数
  //------------------------------------------------------------------------------------------------------------

  //----------------------------------------
  // ▼入力または言語選択が変更されたら翻訳を行う
  //----------------------------------------
  useEffect(
    () => {
      //----------------------------------------
      // ▼翻訳処理を非同期で行う関数
      //----------------------------------------
      const translateText = async () => {
        //----------------------------------------
        // ▼APIキーを設定（この値はDeepL APIのダッシュボードで取得）
        //----------------------------------------
        const apiKey = "apikeyをここに入れるんや!";

        //----------------------------------------
        // ▼axiosに渡す設定オブジェクト
        //----------------------------------------
        const options = {
          //----------------------------------------
          // ▼HTTPメソッドはPOST
          //----------------------------------------
          method: "POST",

          //----------------------------------------
          // ▼DeepL APIのエンドポイント
          //----------------------------------------
          url: "https://api-free.deepl.com/v2/translate",

          //----------------------------------------
          // ▼ヘッダー設定
          //----------------------------------------
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          params: {
            //----------------------------------------
            // ▼APIキー
            //----------------------------------------
            auth_key: apiKey, //先に変数として登録済み "APIキーを設定"
            //----------------------------------------
            // ▼翻訳するテキスト
            //----------------------------------------
            text: inputText, //画面構成箇所にて、valueとして取得
            //----------------------------------------
            // ▼翻訳先の言語
            //----------------------------------------
            target_lang: language, //画面構成箇所にて、valueとして取得
          },
        };

        try {
          //----------------------------------------
          // ▼APIからのレスポンスを受け取る
          //----------------------------------------
          const response = await axios.request(options);

          //----------------------------------------
          // ▼翻訳結果をステートに保存
          //----------------------------------------
          setTranslatedText(response.data.translations[0].text);
        } catch (error) {
          //----------------------------------------
          // ▼エラー発生時はコンソールに出力
          //----------------------------------------
          console.error("Error:", error);
        }
      };

      //----------------------------------------
      // ▼非同期関数を呼び出し
      //----------------------------------------
      translateText();
    },
    //----------------------------------------
    // ▼依存配列。これらのステートが変更された場合にeffectが実行される
    //----------------------------------------
    [inputText, language]
  );

  //----------------------------------------
  // ▼クリップボードにテキストをコピーする関数
  //----------------------------------------
  const copyToClipboard = () => {
    navigator.clipboard.writeText(translatedText);
  };

  //------------------------------------------------------------------------------------------------------------
  // ▼画面構成
  //------------------------------------------------------------------------------------------------------------

  return (
    <div>
      <h1>DeepL翻訳</h1>
      {/* 入力テキストエリア */}
      <textarea
        value={inputText}
        onChange={(e) => setInputText(e.target.value)}
        placeholder='翻訳したいテキストを入力してください'></textarea>

      {/* 言語選択のプルダウン */}
      <select onChange={(e) => setLanguage(e.target.value)}>
        <option value='EN-US'>英語（アメリカ）</option>
        <option value='EN-GB'>英語（イギリス）</option>
        <option value='ZH'>中国語（簡体字）</option>
        <option value='KO'>韓国語</option>
        <option value='JA'>日本語</option>
      </select>

      {/* 翻訳結果の表示エリア */}
      <textarea value={translatedText} readOnly></textarea>

      {/* コピー用ボタン */}
      <button onClick={copyToClipboard}>コピー</button>
    </div>
  );
};

//----------------------------------------
// ▼他のファイルで使えるようにexport
//----------------------------------------
export default DeeplApi;
